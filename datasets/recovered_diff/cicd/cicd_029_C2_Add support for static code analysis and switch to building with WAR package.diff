# Type: cicd
# Subtype: C2
# English Summary: Add support for static code analysis and switch to building with WAR package
# Chinese Summary: 支持静态代码分析、改用war包构建
# Entry Number: 29

# === Git Diff Content ===

diff --git a/Jenkinsfile b/Jenkinsfile
index 34c56d7..89e01f2 100644
--- a/Jenkinsfile
+++ b/Jenkinsfile
@@ -12,12 +12,21 @@
 pipeline {
     agent any
 
+    environment {
+        MAVEN_OPTS = '-Dmaven.repo.local=.m2/repository'
+    }
+
     stages {
         stage('Checkout') {
             steps {
                 checkout scm
             }
         }
+        stage('Static Code Analysis') {
+            steps {
+                sh 'mvn sonar:sonar'
+            }
+        }
         stage('Build') {
             steps {
                 sh 'mvn clean package'
@@ -24,17 +33,17 @@
         stage('Test') {
             steps {
                 sh 'mvn test'
             }
             post {
                 always {
                     junit '**/target/surefire-reports/TEST-*.xml'
                 }
             }
         }
-        stage('Archive') {
+        stage('Deploy and Archive') {
             steps {
                 sh 'mvn deploy'
-                archiveArtifacts artifacts: '**/target/*.jar', fingerprint: true
+                archiveArtifacts artifacts: '**/target/*.war', fingerprint: true
             }
         }
     }